<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wake Map</title>

<style>
body{
  font-family:system-ui,-apple-system;
  background:linear-gradient(180deg,#020617,#0f172a);
  color:#e5e7eb;
  max-width:560px;
  margin:auto;
  padding:16px
}
h1{text-align:center}

.center{text-align:center;margin:12px 0}

button.main{
  background:#38bdf8;
  color:#020617;
  border:none;
  border-radius:18px;
  padding:10px 18px;
  font-weight:600;
  cursor:pointer;
  margin:4px
}

.card{
  background:#020617;
  border-radius:22px;
  padding:22px;
  margin-bottom:16px;
  box-shadow:0 12px 36px rgba(0,0,0,.45)
}

.mission{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:18px 0;
  border-bottom:1px solid #1e293b;
  transition:opacity .6s,transform .6s
}
.mission.done,.mission.fail{opacity:.35;transform:scale(.97)}
.mission:last-child{border-bottom:none}

.point{color:#38bdf8;font-size:.85em}

.actions button{
  border:none;
  border-radius:14px;
  padding:12px 16px;
  font-size:1.3em;
  margin-left:8px;
  cursor:pointer
}
.btn-done{background:#22c55e;color:#022c22}
.btn-fail{background:#ef4444;color:#450a0a}
.btn-del{background:#1e293b;color:#94a3b8}

.big-input{
  width:100%;
  padding:18px;
  font-size:1.05em;
  border-radius:18px;
  border:none;
  margin-bottom:12px
}

.score-big{
  font-size:3.6em;
  font-weight:800;
  text-align:center;
  margin:18px 0 8px
}
.score-big.good{color:#22c55e}
.score-big.bad{color:#ef4444}

.month-info{text-align:center;font-size:.9em;opacity:.85}

#modal{
  position:fixed;inset:0;
  background:rgba(0,0,0,.6);
  display:none;align-items:center;justify-content:center
}
#modal .box{
  background:#020617;
  padding:26px;
  border-radius:22px;
  text-align:center
}
</style>
</head>

<body>
<h1>Wake Map</h1>

<div class="center">
  <button id="goToday" class="main">Hari ini</button>
  <button id="goTomorrow" class="main">Misi Besok</button>
  <button id="goHistory" class="main">History</button>
  <button id="goReward" class="main">Hadiah</button>
</div>

<div id="inputWrap" style="display:none">
  <input id="missionInput" class="big-input" placeholder="Tulis misi besok">
  <div class="center">
    <button id="addMission" class="main">OKE</button>
  </div>
</div>

<div id="rewardWrap" style="display:none">
  <input id="rewardInput" class="big-input" placeholder="Nama hadiah">
  <input id="rewardPoint" class="big-input" placeholder="Target poin bulan ini">
  <div class="center">
    <button id="addReward" class="main">Tambah Hadiah</button>
  </div>
</div>

<div id="app"></div>
<div id="monthly"></div>

<div id="modal">
  <div class="box">
    <h2>üéâ Hadiah Tercapai!</h2>
    <p id="modalText"></p>
    <button id="claimReward" class="main">OK</button>
  </div>
</div>

<script>
const days=["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"];
const app=document.getElementById('app');
const monthly=document.getElementById('monthly');
const inputWrap=document.getElementById('inputWrap');
const rewardWrap=document.getElementById('rewardWrap');
const modal=document.getElementById('modal');
const modalText=document.getElementById('modalText');
const claimReward=document.getElementById('claimReward');

const today=new Date();
const tomorrow=new Date(); tomorrow.setDate(today.getDate()+1);
const todayKey=today.toDateString();
const tomorrowKey=tomorrow.toDateString();

let mode='today', activeKey=todayKey, missions=[];
let rewards=JSON.parse(localStorage.getItem('rewards_active')||'[]');
let rewardHistory=JSON.parse(localStorage.getItem('rewards_history')||'[]');

cleanupOld(); load();

function load(){missions=JSON.parse(localStorage.getItem(activeKey))||[]}
function save(){localStorage.setItem(activeKey,JSON.stringify(missions))}

function totalPoint(l){return l.filter(x=>x.status==='done').reduce((a,b)=>a+b.point,0)}

function monthTotal(off){
  const d=new Date(); d.setMonth(d.getMonth()+off);
  let s=0;
  Object.keys(localStorage).forEach(k=>{
    if(!k.includes('GMT'))return;
    const kd=new Date(k);
    if(kd.getMonth()===d.getMonth()&&kd.getFullYear()===d.getFullYear()){
      s+=totalPoint(JSON.parse(localStorage.getItem(k)))
    }
  });
  return s;
}

function cleanupOld(){
  const now=new Date();
  rewardHistory=rewardHistory.filter(r=>{
    const diff=(now.getFullYear()-r.year)*12+(now.getMonth()-(r.month-1));
    return diff<2;
  });
  localStorage.setItem('rewards_history',JSON.stringify(rewardHistory));
}

function checkReward(){
  const t=monthTotal(0);
  const r=rewards.find(x=>x.target<=t);
  if(!r)return;
  modalText.textContent=r.name;
  modal.style.display='flex';
  claimReward.onclick=()=>{
    modal.style.display='none';
    rewards=rewards.filter(x=>x!==r);
    const n=new Date();
    rewardHistory.push({
      name:r.name,
      day:days[n.getDay()],
      date:n.getDate(),
      month:n.getMonth()+1,
      year:n.getFullYear()
    });
    localStorage.setItem('rewards_active',JSON.stringify(rewards));
    localStorage.setItem('rewards_history',JSON.stringify(rewardHistory));
    render();
  };
}

function deleteReward(i){
  if(!confirm('Hapus hadiah ini?'))return;
  rewards.splice(i,1);
  localStorage.setItem('rewards_active',JSON.stringify(rewards));
  render();
}

function render(){
  app.innerHTML=''; monthly.innerHTML='';
  inputWrap.style.display=mode==='tomorrow'?'block':'none';
  rewardWrap.style.display=mode==='reward'?'block':'none';

  if(mode==='history'){renderHistory();return}
  if(mode==='reward'){renderReward();return}

  const c=document.createElement('div');
  c.className='card';
  c.innerHTML=`<h2>${mode==='today'?'Hari ini':'Misi Besok'}</h2>`;

  missions.forEach((m,i)=>{
    const r=document.createElement('div');
    r.className='mission '+(m.status||'');
    r.innerHTML=`<span>${m.text} <span class="point">(+${m.point})</span></span>`;
    const a=document.createElement('div');a.className='actions';

    if(mode==='today'&&!m.status){
      a.innerHTML=`<button class="btn-done">‚úî</button><button class="btn-fail">‚úñ</button>`;
      a.children[0].onclick=()=>{m.status='done';save();render()};
      a.children[1].onclick=()=>{m.status='fail';save();render()};
    }
    if(mode==='tomorrow'){
      a.innerHTML=`<button class="btn-del">üóë</button>`;
      a.children[0].onclick=()=>{missions.splice(i,1);save();render()};
    }
    if(a.children.length)r.appendChild(a);
    c.appendChild(r);
  });

  if(mode==='today'){
    const s=Math.min(totalPoint(missions),100);
    c.innerHTML+=`<div class="score-big ${s>=60?'good':'bad'}">${s}</div>`;
  }

  app.appendChild(c);

  if(mode==='today'){
    monthly.innerHTML=`
    <div class="month-info">
      Total poin bulan ini: <b>${monthTotal(0)}</b><br>
      Total poin bulan lalu: <b>${monthTotal(-1)}</b>
    </div>`;
    checkReward();
  }
}

function renderHistory(){
  Object.keys(localStorage).filter(k=>k.includes('GMT')).slice(0,60).forEach(k=>{
    const d=new Date(k);
    const l=JSON.parse(localStorage.getItem(k));
    const t=Math.min(totalPoint(l),100);
    app.innerHTML+=`
      <div class="card">
        <small>${days[d.getDay()]}, ${d.getDate()}-${d.getMonth()+1}-${d.getFullYear()}</small>
        <div class="score-big ${t>=60?'good':'bad'}">${t}</div>
      </div>`;
  });
}

function renderReward(){
  const c=document.createElement('div');
  c.className='card';
  c.innerHTML='<h2>Hadiah Aktif</h2>';
  rewards.forEach((r,i)=>{
    c.innerHTML+=`
      <p>üéÅ ${r.name} ‚Äî ${r.target}
      <button onclick="deleteReward(${i})" class="btn-del">üóë</button></p>`;
  });
  c.innerHTML+='<h3>History Hadiah</h3>';
  rewardHistory.forEach(r=>{
    c.innerHTML+=`<small>‚úÖ ${r.name} ‚Äî ${r.day}, ${r.date}-${r.month}-${r.year}</small><br>`;
  });
  app.appendChild(c);
}

addMission.onclick=()=>{
  const t=missionInput.value.trim();
  const p=+prompt('Poin?');
  if(!t||!p)return;
  missions.push({text:t,point:Math.min(p,100),status:null});
  save();missionInput.value='';render();
};

addReward.onclick=()=>{
  const n=rewardInput.value.trim();
  const p=+rewardPoint.value;
  if(!n||!p)return;
  rewards.push({name:n,target:p});
  localStorage.setItem('rewards_active',JSON.stringify(rewards));
  rewardInput.value='';rewardPoint.value='';
  render();
};

goToday.onclick=()=>{mode='today';activeKey=todayKey;load();render()};
goTomorrow.onclick=()=>{mode='tomorrow';activeKey=tomorrowKey;load();render()};
goHistory.onclick=()=>{mode='history';render()};
goReward.onclick=()=>{mode='reward';render()};

render();
</script>
</body>
</html>
