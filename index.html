<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wake Map</title>

<style>
:root{
  --midnight:#020617;
  --navy:#020a2b;
  --blue:#0ea5e9;
  --neon:#38bdf8;
  --soft:#1e3a8a;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui,-apple-system;
  background:linear-gradient(180deg,var(--midnight),var(--navy));
  color:#e5e7eb;
  max-width:560px;
  margin:auto;
  padding:16px;
}

h1{text-align:center;margin-bottom:12px}

.center{text-align:center;margin:14px 0}

button{
  border:none;
  border-radius:18px;
  padding:12px 18px;
  font-weight:600;
  cursor:pointer;
}

.btn-main{
  background:var(--blue);
  color:#020617;
  margin:4px;
}

.card{
  background:#020617;
  border-radius:24px;
  padding:22px;
  margin-bottom:18px;
  box-shadow:0 14px 40px rgba(0,0,0,.45);
}

.big-input{
  width:100%;
  padding:18px;
  font-size:1em;
  border-radius:18px;
  border:none;
  margin-bottom:12px;
}

.mission{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:18px 0;
  border-bottom:1px solid #020f3a;
  transition:opacity .6s,transform .6s;
}
.mission.done,.mission.fail{
  opacity:.35;
  transform:scale(.97);
}
.mission:last-child{border-bottom:none}

.actions button{
  background:#020f3a;
  color:var(--neon);
  font-size:1.1em;
  padding:8px 12px;
  border-radius:14px;
  margin-left:6px;
}

.score{
  font-size:3.4em;
  font-weight:800;
  text-align:center;
  margin-top:16px;
}
.score.zero{color:#ef4444}
.score.ok{color:var(--neon)}

.month-info{
  text-align:center;
  font-size:.9em;
  opacity:.85;
  margin-top:10px;
}

.list-date{
  padding:10px;
  border-radius:14px;
  margin:6px 0;
  background:#020f3a;
  cursor:pointer;
}

#modal{
  position:fixed;inset:0;
  background:rgba(0,0,0,.65);
  display:none;
  align-items:center;
  justify-content:center;
}
#modal .box{
  background:#020617;
  padding:26px;
  border-radius:22px;
  text-align:center;
}
</style>
</head>

<body>
<h1>Wake Map</h1>

<div class="center">
  <button class="btn-main" onclick="go('today')">Hari ini</button>
  <button class="btn-main" onclick="go('tomorrow')">Misi Besok</button>
  <button class="btn-main" onclick="go('history')">History</button>
  <button class="btn-main" onclick="go('reward')">Hadiah</button>
</div>

<div id="inputWrap" style="display:none">
  <input id="missionInput" class="big-input" placeholder="Tulis misi besok">
  <button class="btn-main" onclick="addMission()">OKE</button>
</div>

<div id="rewardWrap" style="display:none">
  <input id="rewardName" class="big-input" placeholder="Nama hadiah">
  <input id="rewardPoint" class="big-input" placeholder="Target poin bulan ini">
  <button class="btn-main" onclick="addReward()">Tambah Hadiah</button>
</div>

<div id="app"></div>
<div id="monthly"></div>

<div id="modal">
  <div class="box">
    <h2>üéâ Hadiah Tercapai!</h2>
    <p id="modalText"></p>
    <button class="btn-main" onclick="claimReward()">OK</button>
  </div>
</div>

<script>
const days=["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"];
const app=document.getElementById('app');
const monthly=document.getElementById('monthly');
const inputWrap=document.getElementById('inputWrap');
const rewardWrap=document.getElementById('rewardWrap');
const modal=document.getElementById('modal');
const modalText=document.getElementById('modalText');

let mode='today', activeKey='', missions=[];
let rewards=JSON.parse(localStorage.getItem('rewards_active')||'[]');
let rewardHistory=JSON.parse(localStorage.getItem('rewards_history')||'[]');
let reachedReward=null;

function dateKey(d){return d.toDateString()}
function load(){missions=JSON.parse(localStorage.getItem(activeKey))||[]}
function save(){localStorage.setItem(activeKey,JSON.stringify(missions))}

function totalPoint(list){
  return list.filter(m=>m.status==='done').reduce((a,b)=>a+b.point,0);
}

function monthTotal(offset){
  const d=new Date(); d.setMonth(d.getMonth()+offset);
  let sum=0;
  Object.keys(localStorage).forEach(k=>{
    if(!k.includes('GMT'))return;
    const kd=new Date(k);
    if(kd.getMonth()===d.getMonth()&&kd.getFullYear()===d.getFullYear()){
      sum+=totalPoint(JSON.parse(localStorage.getItem(k)));
    }
  });
  return sum;
}

function go(m){
  mode=m;
  const today=new Date();
  if(m==='today') activeKey=dateKey(today);
  if(m==='tomorrow'){today.setDate(today.getDate()+1);activeKey=dateKey(today);}
  load(); render();
}

function addMission(){
  const t=missionInput.value.trim();
  const p=+prompt('Poin misi?');
  if(!t||!p)return;
  missions.push({text:t,point:p,status:null});
  save(); missionInput.value=''; render();
}

function render(){
  app.innerHTML=''; monthly.innerHTML='';
  inputWrap.style.display=mode==='tomorrow'?'block':'none';
  rewardWrap.style.display=mode==='reward'?'block':'none';

  if(mode==='history') return renderHistory();
  if(mode==='reward') return renderReward();

  const d=new Date(activeKey);
  const title=mode==='today'
    ?'Hari ini'
    :'Misi Besok '+days[d.getDay()];

  const c=document.createElement('div');
  c.className='card';
  c.innerHTML=`<h2>${title}</h2>`;

  if(missions.length===0){
    c.innerHTML+='<p style="opacity:.5">Kosong</p>';
  }

  missions.forEach((m,i)=>{
    const row=document.createElement('div');
    row.className='mission '+(m.status||'');
    row.innerHTML=`<span>${m.text} (+${m.point})</span>`;
    const a=document.createElement('div');a.className='actions';

    if(mode==='today'&&!m.status){
      a.innerHTML='<button>‚úî</button><button>‚úñ</button>';
      a.children[0].onclick=()=>{m.status='done';save();render()};
      a.children[1].onclick=()=>{m.status='fail';save();render()};
    }

    if(mode==='tomorrow'){
      a.innerHTML='<button>üóë</button>';
      a.children[0].onclick=()=>{missions.splice(i,1);save();render()};
    }

    if(a.children.length) row.appendChild(a);
    c.appendChild(row);
  });

  if(mode==='today'){
    const s=totalPoint(missions);
    c.innerHTML+=`<div class="score ${s===0?'zero':'ok'}">${s}</div>`;
  }

  app.appendChild(c);

  if(mode==='today'){
    monthly.innerHTML=`
      <div class="month-info">
        Bulan ini: <b>${monthTotal(0)}</b><br>
        Bulan lalu: <b>${monthTotal(-1)}</b>
      </div>`;
    checkReward();
  }
}

function renderHistory(){
  Object.keys(localStorage).filter(k=>k.includes('GMT')).slice(0,60).forEach(k=>{
    const d=new Date(k);
    app.innerHTML+=`
      <div class="list-date" onclick="openDay('${k}')">
        ${days[d.getDay()]}, ${d.getDate()}-${d.getMonth()+1}-${d.getFullYear()}
      </div>`;
  });
}

function openDay(k){
  activeKey=k; load(); mode='today'; render();
}

function addReward(){
  const n=rewardName.value.trim();
  const p=+rewardPoint.value;
  if(!n||!p)return;
  rewards.push({name:n,target:p});
  localStorage.setItem('rewards_active',JSON.stringify(rewards));
  rewardName.value='';rewardPoint.value='';
  render();
}

function renderReward(){
  const c=document.createElement('div');
  c.className='card';
  c.innerHTML='<h2>Hadiah Aktif</h2>';
  rewards.forEach((r,i)=>{
    c.innerHTML+=`
      <p>üéÅ ${r.name} (${r.target})
      <button onclick="deleteReward(${i})">üóë</button></p>`;
  });
  c.innerHTML+='<h3>History</h3>';
  rewardHistory.forEach(r=>{
    c.innerHTML+=`<small>${r.day}, ${r.date}-${r.month}-${r.year} ‚Äî ${r.name}</small><br>`;
  });
  app.appendChild(c);
}

function deleteReward(i){
  rewards.splice(i,1);
  localStorage.setItem('rewards_active',JSON.stringify(rewards));
  render();
}

function checkReward(){
  const t=monthTotal(0);
  reachedReward=rewards.find(r=>t>=r.target);
  if(!reachedReward)return;
  modalText.textContent=reachedReward.name;
  modal.style.display='flex';
}

function claimReward(){
  modal.style.display='none';
  const n=new Date();
  rewardHistory.push({
    name:reachedReward.name,
    day:days[n.getDay()],
    date:n.getDate(),
    month:n.getMonth()+1,
    year:n.getFullYear()
  });
  rewards=rewards.filter(r=>r!==reachedReward);
  localStorage.setItem('rewards_active',JSON.stringify(rewards));
  localStorage.setItem('rewards_history',JSON.stringify(rewardHistory));
  render();
}

go('today');
</script>
</body>
</html>
