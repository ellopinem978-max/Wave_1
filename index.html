<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wake Map</title>

<style>
body{
  font-family:system-ui,-apple-system;
  background:linear-gradient(180deg,#020617,#0f172a);
  color:#e5e7eb;
  max-width:560px;
  margin:auto;
  padding:16px
}
h1{text-align:center}

.center{text-align:center;margin:12px 0}

button.main{
  background:#38bdf8;
  color:#020617;
  border:none;
  border-radius:18px;
  padding:10px 18px;
  font-weight:600;
  cursor:pointer;
  margin:4px
}

.card{
  background:#020617;
  border-radius:22px;
  padding:22px;
  margin-bottom:16px;
  box-shadow:0 12px 36px rgba(0,0,0,.45)
}

.mission{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:18px 0;
  border-bottom:1px solid #1e293b;
  font-size:1.05em;
  transition:opacity .6s ease, transform .6s ease;
}
.mission:last-child{border-bottom:none}

.mission.done,
.mission.fail{
  opacity:.35;
  transform:scale(.97);
}

.point{color:#38bdf8;font-size:.9em}

.actions button{
  border:none;
  border-radius:14px;
  padding:12px 16px;
  font-size:1.3em;
  margin-left:8px;
  cursor:pointer
}
.btn-done{background:#22c55e;color:#022c22}
.btn-fail{background:#ef4444;color:#450a0a}
.btn-del{
  background:#1e293b;
  color:#94a3b8;
  font-size:1.1em
}

.big-input{
  width:100%;
  padding:18px;
  font-size:1.05em;
  border-radius:18px;
  border:none;
  margin-bottom:12px
}

.score-big{
  font-size:3.6em;
  font-weight:800;
  text-align:center;
  margin:18px 0 8px
}
.score-big.good{color:#22c55e}
.score-big.bad{color:#ef4444}

.month-info{
  text-align:center;
  font-size:.95em;
  opacity:.85;
  margin-bottom:20px
}

small{opacity:.6}
</style>
</head>

<body>
<h1>Wake Map</h1>

<div class="center">
  <button id="goToday" class="main">Hari ini</button>
  <button id="goTomorrow" class="main">Misi Besok</button>
  <button id="goHistory" class="main">History</button>
</div>

<div id="inputWrap" style="display:none">
  <input id="missionInput" class="big-input" placeholder="Tulis misi besok">
  <div class="center">
    <button id="addMission" class="main">OKE</button>
  </div>
</div>

<div id="app"></div>
<div id="monthly"></div>

<script>
const days=["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"];
const app=document.getElementById('app');
const monthly=document.getElementById('monthly');
const inputWrap=document.getElementById('inputWrap');

const today=new Date();
const tomorrow=new Date(); tomorrow.setDate(today.getDate()+1);

const todayKey=today.toDateString();
const tomorrowKey=tomorrow.toDateString();

let mode='today';
let activeKey=todayKey;
let missions=[];

cleanupOldData();
load();

function load(){
  missions=JSON.parse(localStorage.getItem(activeKey))||[];
}
function save(){
  localStorage.setItem(activeKey,JSON.stringify(missions));
}

function totalPoint(list){
  return list.filter(m=>m.status==='done')
             .reduce((a,b)=>a+b.point,0);
}

function monthTotal(offset){
  const d=new Date(); d.setMonth(d.getMonth()+offset);
  let sum=0;
  Object.keys(localStorage).forEach(k=>{
    if(!k.includes('GMT')) return;
    const kd=new Date(k);
    if(kd.getMonth()===d.getMonth() && kd.getFullYear()===d.getFullYear()){
      sum+=totalPoint(JSON.parse(localStorage.getItem(k)));
    }
  });
  return sum;
}

function cleanupOldData(){
  const now=new Date();
  Object.keys(localStorage).forEach(k=>{
    if(!k.includes('GMT')) return;
    const d=new Date(k);
    const diff=(now.getFullYear()-d.getFullYear())*12+(now.getMonth()-d.getMonth());
    if(diff>=2) localStorage.removeItem(k);
  });
}

function render(){
  app.innerHTML='';
  monthly.innerHTML='';
  inputWrap.style.display = mode==='tomorrow'?'block':'none';

  if(mode==='history'){ renderHistory(); return; }

  const card=document.createElement('div');
  card.className='card';
  card.innerHTML = mode==='today'
    ? `<h2>Hari ini</h2>`
    : `<h2>Misi Besok ${days[tomorrow.getDay()]}</h2>`;

  if(missions.length===0){
    card.innerHTML+=`<p><small>kosong</small></p>`;
  }

  missions.forEach((m,i)=>{
    const row=document.createElement('div');
    row.className=`mission ${m.status||''}`;
    row.innerHTML=`<span>${m.text} <span class="point">(+${m.point})</span></span>`;

    const act=document.createElement('div');
    act.className='actions';

    if(mode==='today' && !m.status){
      const ok=document.createElement('button');
      ok.className='btn-done'; ok.textContent='âœ”';
      ok.onclick=()=>{m.status='done'; save(); render();};

      const no=document.createElement('button');
      no.className='btn-fail'; no.textContent='âœ–';
      no.onclick=()=>{m.status='fail'; save(); render();};

      act.append(ok,no);
    }

    if(mode==='tomorrow'){
      const del=document.createElement('button');
      del.className='btn-del';
      del.textContent='ðŸ—‘';
      del.onclick=()=>{
        missions.splice(i,1);
        save(); render();
      };
      act.append(del);
    }

    if(act.children.length>0) row.appendChild(act);
    card.appendChild(row);
  });

  if(mode==='today'){
    const score=Math.min(totalPoint(missions),100);
    const s=document.createElement('div');
    s.className='score-big '+(score>=60?'good':'bad');
    s.textContent=score;
    card.appendChild(s);
  }

  app.appendChild(card);

  if(mode==='today'){
    monthly.innerHTML=`
      <div class="month-info">
        Total poin bulan ini: <b>${monthTotal(0)}</b><br>
        Total poin bulan lalu: <b>${monthTotal(-1)}</b>
      </div>`;
  }
}

function renderHistory(){
  Object.keys(localStorage)
    .filter(k=>k.includes('GMT'))
    .sort((a,b)=>new Date(b)-new Date(a))
    .forEach(k=>{
      const d=new Date(k);
      const list=JSON.parse(localStorage.getItem(k));
      if(!Array.isArray(list)) return;

      const total=Math.min(totalPoint(list),100);
      const card=document.createElement('div');
      card.className='card';
      card.innerHTML=`
        <h3>${days[d.getDay()]}</h3>
        <small>${d.getDate()}-${d.getMonth()+1}-${d.getFullYear()}</small>
        <div class="score-big ${total>=60?'good':'bad'}">${total}</div>
      `;

      list.forEach(m=>{
        const r=document.createElement('div');
        r.className='mission done';
        r.innerHTML=`${m.text} <span class="point">(+${m.point})</span>`;
        card.appendChild(r);
      });

      app.appendChild(card);
    });
}

addMission.onclick=()=>{
  const t=missionInput.value.trim();
  if(!t) return;
  const p=+prompt('Masukkan poin (1â€“100):');
  if(!p||p<1) return;
  missions.push({text:t,point:Math.min(p,100),status:null});
  save(); missionInput.value=''; render();
};

goToday.onclick=()=>{mode='today'; activeKey=todayKey; load(); render();};
goTomorrow.onclick=()=>{mode='tomorrow'; activeKey=tomorrowKey; load(); render();};
goHistory.onclick=()=>{mode='history'; render();};

render();
</script>
</body>
</html>
