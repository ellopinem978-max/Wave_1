<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wake Map</title>

<style>
/* ================== THEME ================== */
:root{
  --midnight:#020617;
  --navy:#020a2b;
  --deep:#020f3a;
  --soft:#1e3a8a;
  --blue:#0ea5e9;
  --neon:#38bdf8;
  --danger:#ef4444;
  --glass:rgba(255,255,255,.06);
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui,-apple-system;
  background:linear-gradient(180deg,var(--midnight),var(--navy));
  color:#e5e7eb;
  max-width:520px;
  margin:auto;
  padding:18px 16px 120px;
}

/* ================== GLOBAL ================== */
h1,h2,h3{margin:0 0 14px}
button{
  border:none;
  border-radius:18px;
  padding:14px 18px;
  font-weight:700;
  font-size:1em;
  background:var(--blue);
  color:#020617;
  cursor:pointer;
  transition:.25s;
}
button:active{transform:scale(.94)}
button.ghost{
  background:var(--glass);
  color:var(--neon);
}

/* ================== NAV ================== */
.nav{
  display:flex;
  gap:10px;
  justify-content:center;
  margin-bottom:18px;
}

/* ================== CARD ================== */
.card{
  background:linear-gradient(180deg,var(--midnight),var(--deep));
  border-radius:28px;
  padding:22px;
  margin-bottom:22px;
  box-shadow:0 20px 60px rgba(0,0,0,.45);
  animation:fadeUp .45s ease;
}

@keyframes fadeUp{
  from{opacity:0;transform:translateY(20px)}
  to{opacity:1;transform:none}
}

/* ================== INPUT ================== */
.big-input{
  width:100%;
  padding:18px;
  border-radius:20px;
  border:none;
  font-size:1em;
  margin-bottom:12px;
}

/* ================== MISSION ================== */
.mission{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:16px 0;
  border-bottom:1px solid var(--deep);
  transition:.4s;
}
.mission:last-child{border:none}
.mission.done,
.mission.fail{
  opacity:.35;
  transform:scale(.96);
}

.actions{
  display:flex;
  gap:10px;
  transition:.35s;
}
.actions.hide{
  opacity:0;
  transform:scale(.7);
  pointer-events:none;
}

/* ================== SCORE ================== */
.score{
  text-align:center;
  font-size:3.4em;
  font-weight:900;
  margin-top:20px;
}
.score.zero{color:var(--danger)}
.score.ok{color:var(--neon)}

/* ================== HISTORY ================== */
.list-date{
  background:var(--deep);
  padding:18px;
  border-radius:20px;
  margin:10px 0;
  cursor:pointer;
  transition:.25s;
}
.list-date:hover{background:var(--soft)}

/* ================== MODAL ================== */
#modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.65);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:10;
}
#modal .box{
  background:var(--midnight);
  padding:28px;
  border-radius:26px;
  width:85%;
  text-align:center;
  animation:zoom .4s ease;
}
@keyframes zoom{
  from{transform:scale(.7);opacity:0}
  to{transform:scale(1);opacity:1}
}

small{opacity:.75}
</style>
</head>

<body>

<h1>Wake Map</h1>

<div class="nav">
  <button onclick="go('today')">Hari Ini</button>
  <button onclick="go('tomorrow')">Besok</button>
  <button onclick="go('history')">History</button>
  <button onclick="go('reward')">Hadiah</button>
</div>

<div id="inputWrap" style="display:none">
  <input id="missionInput" class="big-input" placeholder="Tambah misi besok">
  <button onclick="addMission()">Tambah Misi</button>
</div>

<div id="rewardWrap" style="display:none">
  <input id="rewardName" class="big-input" placeholder="Nama hadiah">
  <input id="rewardPoint" class="big-input" placeholder="Target poin bulan ini">
  <button onclick="addReward()">Tambah Hadiah</button>
</div>

<div id="app"></div>
<div id="monthly"></div>

<div id="modal">
  <div class="box">
    <h2>ðŸŽ‰ Hadiah Tercapai</h2>
    <p id="modalText"></p>
    <button onclick="claimReward()">OK</button>
  </div>
</div>

<script>
/* ================== CORE ================== */
const days=["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"];
const app=document.getElementById('app');
const monthly=document.getElementById('monthly');
const modal=document.getElementById('modal');
const modalText=document.getElementById('modalText');
const inputWrap=document.getElementById('inputWrap');
const rewardWrap=document.getElementById('rewardWrap');

let mode='today';
let activeKey='';
let missions=[];
let rewards=JSON.parse(localStorage.getItem('rewards')||'[]');
let rewardHistory=JSON.parse(localStorage.getItem('reward_history')||'[]');
let isHistoryView=false;
let reachedReward=null;

/* ================== DATE ================== */
const iso=d=>d.toISOString().slice(0,10);
const todayKey=()=>iso(new Date());
const yesterdayKey=()=>{let d=new Date();d.setDate(d.getDate()-1);return iso(d);}
const tomorrowKey=()=>{let d=new Date();d.setDate(d.getDate()+1);return iso(d);}

/* ================== STORAGE ================== */
function load(){
  missions=JSON.parse(localStorage.getItem(activeKey)||'[]');
}
function save(){
  localStorage.setItem(activeKey,JSON.stringify(missions));
}

/* ================== LOGIC ================== */
function totalPoint(list){
  return list.filter(m=>m.status==='done')
             .reduce((a,b)=>a+b.point,0);
}

function monthTotal(offset){
  const d=new Date();d.setMonth(d.getMonth()+offset);
  let sum=0;
  Object.keys(localStorage).forEach(k=>{
    if(!/^\d{4}-\d{2}-\d{2}$/.test(k))return;
    const kd=new Date(k);
    if(kd.getMonth()===d.getMonth()&&kd.getFullYear()===d.getFullYear()){
      sum+=totalPoint(JSON.parse(localStorage.getItem(k)));
    }
  });
  return sum;
}

/* ================== NAV ================== */
function go(m){
  isHistoryView=false;
  mode=m;
  inputWrap.style.display='none';
  rewardWrap.style.display='none';
  if(m==='today')activeKey=todayKey();
  if(m==='tomorrow')activeKey=tomorrowKey();
  load();
  render();
}


/* ================== ADD ================== */
function addMission(){
  if(mode!=='tomorrow')return alert('Hanya untuk besok');
  const t=missionInput.value.trim();
  const p=Number(prompt('Poin misi?'));
  if(!t||p<=0)return;
  missions.push({text:t,point:p,status:null});
  save();
  missionInput.value='';
  render();
}

/* ================== RENDER ================== */
function render(){
  app.innerHTML='';
  monthly.innerHTML='';
  inputWrap.style.display=mode==='tomorrow'?'block':'none';
  rewardWrap.style.display=mode==='reward'?'block':'none';

  if(mode==='history')return renderHistory();
  if(mode==='reward')return renderReward();
  if(mode==='today' && !isHistoryView && missions.length===0){
  app.innerHTML = `
    <div class="card">
      <h2>Misi Hari Ini</h2>
      <small>Tidak ada misi hari ini</small>
    </div>`;
  return;
}


  const d=new Date(activeKey);
  const card=document.createElement('div');
  card.className='card';
  card.innerHTML=`<h2>${mode==='today'?'Misi Hari Ini':'Misi Besok '+days[d.getDay()]}</h2>`;

  missions.forEach((m,i)=>{
    const row=document.createElement('div');
    row.className='mission '+(m.status||'');
    row.innerHTML=`<span>${m.text} (+${m.point})</span>`;
    const a=document.createElement('div');
    a.className='actions';

    if(mode==='today'&&!m.status){
      ['âœ”','âœ–'].forEach((s,j)=>{
        const b=document.createElement('button');
        b.textContent=s;
        b.onclick=()=>{
          m.status=j===0?'done':'fail';
          a.classList.add('hide');
          save();
          requestAnimationFrame(()=>save());
          setTimeout(()=>render(),200);

        };
        a.appendChild(b);
      });
    }

    if(mode==='tomorrow'){
      const b=document.createElement('button');
      b.textContent='ðŸ—‘';
      b.onclick=()=>{missions.splice(i,1);save();render()};
      a.appendChild(b);
    }

    if(a.children.length)row.appendChild(a);
    card.appendChild(row);
  });

  if(mode==='today'){
    const sum=totalPoint(missions);
    card.innerHTML+=`<div class="score ${sum?'ok':'zero'}">${sum}</div>`;
  }

  app.appendChild(card);

  monthly.innerHTML=`
    <small>
    Bulan ini: ${monthTotal(0)} poin<br>
    Bulan lalu: ${monthTotal(-1)} poin
    </small>`;

  checkReward();
}

/* ================== HISTORY ================== */
function renderHistory(){
  const limit=new Date();limit.setMonth(limit.getMonth()-2);
  Object.keys(localStorage)
    .filter(k=>/^\d{4}-\d{2}-\d{2}$/.test(k)&&new Date(k)>=limit)
    .sort((a,b)=>b.localeCompare(a))
    .forEach(k=>{
      const d=new Date(k);
      app.innerHTML+=`
        <div class="list-date" onclick="openDay('${k}')">
          ${days[d.getDay()]} ${d.getDate()}-${d.getMonth()+1}-${d.getFullYear()}
        </div>`;
    });
}

function openDay(k){
  isHistoryView=true;
  activeKey=k;
  mode='today';
  load();
  render();
}


/* ================== REWARD ================== */
function addReward(){
  const n=rewardName.value.trim();
  const p=Number(rewardPoint.value);
  if(!n||p<=0)return;
  rewards.push({name:n,target:p});
  localStorage.setItem('rewards',JSON.stringify(rewards));
  rewardName.value=rewardPoint.value='';
  render();
}

function renderReward(){
  const c=document.createElement('div');
  c.className='card';
  c.innerHTML='<h2>Hadiah Aktif</h2>';
  rewards.forEach((r,i)=>{
    c.innerHTML+=`${r.name} (${r.target})
      <button onclick="deleteReward(${i})">ðŸ—‘</button><br>`;
  });
  c.innerHTML+='<h3>History Hadiah</h3>';
  rewardHistory.forEach(r=>{
    const d=new Date(r.date);
    c.innerHTML+=`<small>${days[d.getDay()]} ${d.getDate()}-${d.getMonth()+1}-${d.getFullYear()} â€” ${r.name}</small><br>`;
  });
  app.appendChild(c);
}

function deleteReward(i){
  rewards.splice(i,1);
  localStorage.setItem('rewards',JSON.stringify(rewards));
  render();
}

function checkReward(){
  const t=monthTotal(0);
  reachedReward=rewards.find(r=>t>=r.target);
  if(!reachedReward)return;
  modalText.textContent=reachedReward.name;
  modal.style.display='flex';
}

function claimReward(){
  rewardHistory.push({name:reachedReward.name,date:new Date().toISOString()});
  rewards=rewards.filter(r=>r!==reachedReward);
  localStorage.setItem('rewards',JSON.stringify(rewards));
  localStorage.setItem('reward_history',JSON.stringify(rewardHistory));
  modal.style.display='none';
  render();
}

go('today');
</script>
</body>
</html>
