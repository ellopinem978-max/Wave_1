<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wake Map</title>

<style>
:root{
  --midnight:#020617;
  --navy:#020a2b;
  --deep:#020f3a;
  --soft:#1e3a8a;
  --blue:#0ea5e9;
  --neon:#38bdf8;
  --danger:#ef4444;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui,-apple-system;
  background:linear-gradient(180deg,var(--midnight),var(--navy));
  color:#e5e7eb;
  max-width:560px;
  margin:auto;
  padding:16px;
}

h1{text-align:center;margin:12px 0}

.center{
  text-align:center;
  margin-bottom:14px;
}

button{
  border:none;
  border-radius:18px;
  padding:14px 18px;
  font-weight:600;
  cursor:pointer;
}

.btn-main{
  background:var(--blue);
  color:#020617;
  margin:4px;
}

.card{
  background:var(--midnight);
  border-radius:24px;
  padding:22px;
  margin-bottom:18px;
  box-shadow:0 14px 40px rgba(0,0,0,.45);
}

.big-input{
  width:100%;
  padding:18px;
  font-size:1em;
  border-radius:18px;
  border:none;
  margin-bottom:12px;
}

.mission{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:16px 0;
  border-bottom:1px solid var(--deep);
  transition:opacity .6s, transform .6s;
}
.mission:last-child{border-bottom:none}

.mission.done,
.mission.fail{
  opacity:.35;
  transform:scale(.96);
}
.mission{
  transition:opacity .6s ease, transform .6s ease;
}

.actions button{
  transition:opacity .4s ease, transform .4s ease;
}

.actions{
  display:flex;
  gap:8px;
}

.actions button{
  background:var(--deep);
  color:var(--neon);
  padding:8px 12px;
  border-radius:12px;
  font-size:1.1em;
  transition:opacity .4s, transform .4s;
}

.actions.hide{
  opacity:0;
  transform:scale(.8);
  pointer-events:none;
}

.score{
  font-size:3.2em;
  font-weight:800;
  text-align:center;
  margin-top:16px;
}
.score.zero{color:var(--danger)}
.score.ok{color:var(--neon)}

.month-info{
  text-align:center;
  font-size:.9em;
  opacity:.85;
  margin-top:12px;
}

.list-date{
  background:var(--deep);
  padding:14px;
  border-radius:16px;
  margin:8px 0;
  cursor:pointer;
}

small{opacity:.75}

#modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.65);
  display:none;
  align-items:center;
  justify-content:center;
}
#modal .box{
  background:var(--midnight);
  padding:26px;
  border-radius:22px;
  text-align:center;
  width:85%;
}
</style>
</head>

<body>
<h1>Wake Map</h1>

<div class="center">
  <button class="btn-main" onclick="go('today')">Hari ini</button>
  <button class="btn-main" onclick="go('tomorrow')">Misi Besok</button>
  <button class="btn-main" onclick="go('history')">History</button>
  <button class="btn-main" onclick="go('reward')">Hadiah</button>
</div>

<div id="inputWrap" style="display:none">
  <input id="missionInput" class="big-input" placeholder="Tambah misi besok">
  <button class="btn-main" onclick="addMission()">Tambah</button>
</div>

<div id="rewardWrap" style="display:none">
  <input id="rewardName" class="big-input" placeholder="Nama hadiah">
  <input id="rewardPoint" class="big-input" placeholder="Target poin bulan ini">
  <button class="btn-main" onclick="addReward()">Tambah Hadiah</button>
</div>

<div id="app"></div>
<div id="monthly"></div>

<div id="modal">
  <div class="box">
    <h2>üéâ Hadiah Tercapai</h2>
    <p id="modalText"></p>
    <button class="btn-main" onclick="claimReward()">OK</button>
  </div>
</div>

<script>
const days=["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"];
const app=document.getElementById('app');
const monthly=document.getElementById('monthly');
const inputWrap=document.getElementById('inputWrap');
const rewardWrap=document.getElementById('rewardWrap');
const modal=document.getElementById('modal');
const modalText=document.getElementById('modalText');

let mode='today';
let activeKey='';
let missions=[];
let rewards=JSON.parse(localStorage.getItem('rewards_active')||'[]');
let rewardHistory=JSON.parse(localStorage.getItem('rewards_history')||'[]');
let reachedReward=null;

function key(d){return d.toDateString();}
function load(){missions=JSON.parse(localStorage.getItem(activeKey)||'[]');}
function save(){localStorage.setItem(activeKey,JSON.stringify(missions));}

function totalPoint(list){
  return list.filter(m=>m.status==='done').reduce((a,b)=>a+b.point,0);
}

function monthTotal(offset){
  const d=new Date();
  d.setMonth(d.getMonth()+offset);
  let sum=0;
  Object.keys(localStorage).forEach(k=>{
    if(!k.includes('GMT'))return;
    const kd=new Date(k);
    if(kd.getMonth()===d.getMonth() && kd.getFullYear()===d.getFullYear()){
      sum+=totalPoint(JSON.parse(localStorage.getItem(k)));
    }
  });
  return sum;
}

function go(m){
  mode=m;
  const d=new Date();
  if(m==='today') activeKey=key(d);
  if(m==='tomorrow'){d.setDate(d.getDate()+1);activeKey=key(d);}
  load();
  render();
}

function addMission(){
  const t=missionInput.value.trim();
  const p=+prompt('Poin misi?');
  if(!t||!p)return;
  missions.push({text:t,point:p,status:null});
  save();
  missionInput.value='';
  render();
}

function render(){
  app.innerHTML='';
  monthly.innerHTML='';
  inputWrap.style.display=mode==='tomorrow'?'block':'none';
  rewardWrap.style.display=mode==='reward'?'block':'none';

  if(mode==='history') return renderHistory();
  if(mode==='reward') return renderReward();

  const d=new Date(activeKey);
  const title=mode==='today'
    ?'Misi Hari Ini'
    :'Misi Besok '+days[d.getDay()];

  const c=document.createElement('div');
  c.className='card';
  c.innerHTML=`<h2>${title}</h2>`;

  if(missions.length===0){
    c.innerHTML+='<p style="opacity:.5">Kosong</p>';
  }

  missions.forEach((m,i)=>{
    const row=document.createElement('div');
    row.className='mission '+(m.status||'');
    row.innerHTML=`<span>${m.text} (+${m.point})</span>`;

    const a=document.createElement('div');
    a.className='actions';

    if(mode==='today' && !m.status){
      const ok=document.createElement('button');
      ok.textContent='‚úî';
      const no=document.createElement('button');
      no.textContent='‚úñ';

      ok.onclick = () => {
  m.status = 'done';

  row.classList.add('done');
  a.classList.add('hide');

  // tunggu animasi selesai, baru simpan & re-render
  setTimeout(() => {
    save();
    render();
  }, 700);
};

no.onclick = () => {
  m.status = 'fail';

  row.classList.add('fail');
  a.classList.add('hide');

  setTimeout(() => {
    save();
    render();
  }, 700);
};


      a.append(ok,no);
    }

    if(mode==='tomorrow'){
      const del=document.createElement('button');
      del.textContent='üóë';
      del.onclick=()=>{
        row.style.opacity='.3';
        row.style.transform='scale(.95)';
        setTimeout(()=>{
          missions.splice(i,1);
          save();
          render();
        },400);
      };
      a.append(del);
    }

    if(a.children.length) row.appendChild(a);
    c.appendChild(row);
  });

  if(mode==='today'){
    const sum=totalPoint(missions);
    c.innerHTML+=`
      <div class="score ${sum===0?'zero':'ok'}">${sum}</div>
      <div class="month-info">Total poin hari ini</div>`;
  }

  app.appendChild(c);

  monthly.innerHTML=`
    <div class="month-info">
      Bulan ini: ${monthTotal(0)} poin<br>
      Bulan lalu: ${monthTotal(-1)} poin
    </div>`;

  checkReward();
}

function renderHistory(){
  Object.keys(localStorage)
    .filter(k=>k.includes('GMT'))
    .slice(0,60)
    .forEach(k=>{
      const d=new Date(k);
      app.innerHTML+=`
        <div class="list-date" onclick="openDay('${k}')">
          ${days[d.getDay()]},
          ${d.getDate()}-${d.getMonth()+1}-${d.getFullYear()}
        </div>`;
    });
}

function openDay(k){
  activeKey=k;
  mode='today';
  load();
  render();
}

function addReward(){
  const n=rewardName.value.trim();
  const p=+rewardPoint.value;
  if(!n||!p)return;
  rewards.push({name:n,target:p});
  localStorage.setItem('rewards_active',JSON.stringify(rewards));
  rewardName.value='';
  rewardPoint.value='';
  render();
}

function renderReward(){
  const c=document.createElement('div');
  c.className='card';
  c.innerHTML='<h2>Hadiah Aktif</h2>';
  rewards.forEach((r,i)=>{
    c.innerHTML+=`
      <p>üéÅ ${r.name} (${r.target})
      <button onclick="deleteReward(${i})">üóë</button></p>`;
  });
  c.innerHTML+='<h3>History Hadiah</h3>';
  rewardHistory.forEach(r=>{
    c.innerHTML+=`
      <small>${r.day},
      ${r.date}-${r.month}-${r.year} ‚Äî ${r.name}</small><br>`;
  });
  app.appendChild(c);
}

function deleteReward(i){
  rewards.splice(i,1);
  localStorage.setItem('rewards_active',JSON.stringify(rewards));
  render();
}

function checkReward(){
  const t=monthTotal(0);
  reachedReward=rewards.find(r=>t>=r.target);
  if(!reachedReward)return;
  modalText.textContent=reachedReward.name;
  modal.style.display='flex';
}

function claimReward(){
  modal.style.display='none';
  const n=new Date();
  rewardHistory.push({
    name:reachedReward.name,
    day:days[n.getDay()],
    date:n.getDate(),
    month:n.getMonth()+1,
    year:n.getFullYear()
  });
  rewards=rewards.filter(r=>r!==reachedReward);
  localStorage.setItem('rewards_active',JSON.stringify(rewards));
  localStorage.setItem('rewards_history',JSON.stringify(rewardHistory));
  render();
}

go('today');
</script>
</body>
</html>
